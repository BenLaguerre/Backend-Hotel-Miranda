# https://github.com/marketplace/actions/newman-action
name: Newman Run
on:
  push:
    branches:
      - Azure

jobs:
  echo:
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      # Runs a single command using the runners shell
      - name: Run a one-line script
        run: echo Hello, world!

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.
          
      - name: 'Call Endpoint API'
      uses: indiesdev/curl@v1
      with:
        # The target URL
        # Required: true if custom-config is not set
        url: https://hotelmirandaappservice.azurewebsites.net/
                
        # The request method, basically it's one of GET|POST|PUT|PATCH
        # Default is GET 
        method: 'GET'

        # List of response status codes to be accepted, else it will set the job to be failed
        # If more than one value is needed, you can use comma(,) as seperator
        # In this case if the response status code is not one of 200, 201 and 204, the job will be failed
        # Default is 200,201,204
        accept: 200      

  newman:
    runs-on: ubuntu-latest
    needs: echo
    steps:
      - uses: actions/checkout@master
      - uses: matt-ball/newman-action@master
        with:          
          collection: RestrictedBacked.postman_collection.json
